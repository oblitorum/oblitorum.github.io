<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Be Aware of How ListenAndServeTLS Handles Http Request on Golang net/http Package :: Jason Ng â€” Blogger</title><meta name=author content="John Dodo"><meta name=application-name content="Jason Ng"><meta name=description content="On version >= 1.12, Golang changes its way to handle HTTP request when you serve with ListenAndServeTLS method."><meta name=robots content="noodp"><meta name=generator content="Hugo 0.110.0"><meta name=referrer content="no-referrer"><meta name=format-detection content="telephone=no"><meta name=keywords content="John Dodo,ordinary-extinction,blog"><link rel=canonical href=https://oblitorum.github.io/articles/be-aware-of-how-listenandservetls-handles-http-request-on-golang-net-http-package/><link rel=icon href=https://oblitorum.github.io/logo.png><meta name=twitter:card content="summary"><meta name=twitter:title content="Be Aware of How ListenAndServeTLS Handles Http Request on Golang net/http Package"><meta name=twitter:description content="On version >= 1.12, Golang changes its way to handle HTTP request when you serve with ListenAndServeTLS method."><meta name=twitter:site content="https://oblitorum.github.io/"><meta name=twitter:creator content="John Dodo"><meta name=twitter:image content="https://oblitorum.github.io/logo.png"><meta property="og:type" content="article"><meta property="og:locale" content="en"><meta property="og:name" content="John Dodo"><meta property="og:title" content="Be Aware of How ListenAndServeTLS Handles Http Request on Golang net/http Package"><meta property="og:url" content="https://oblitorum.github.io/"><meta property="og:site_name" content="Jason Ng"><meta property="og:description" content="On version >= 1.12, Golang changes its way to handle HTTP request when you serve with ListenAndServeTLS method."><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/oblitorum.github.io\/articles\/be-aware-of-how-listenandservetls-handles-http-request-on-golang-net-http-package\/"},"headline":"Be Aware of How ListenAndServeTLS Handles Http Request on Golang net\/http Package","datePublished":"2022-04-04","dateModified":"2022-04-04 17:53:38 \u002b0800 \u002b0800","author":{"@type":"Person","name":"John Dodo"},"description":"On version \u0026gt;= 1.12, Golang changes its way to handle HTTP request when you serve with ListenAndServeTLS method.","publisher":{"@type":"Organization","name":"https:\/\/oblitorum.github.io\/","logo":{"@type":"ImageObject","url":"https:\/\/oblitorum.github.io\/logo.png"}}}</script><link rel=stylesheet href=https://oblitorum.github.io/scss/main.min.8db9ebb5c7e0ed0c2265b645cd5fdc50d86e133e1645f61eb59de0565162502791ae133214480076c04e46c38410d447ca0e7cc9e91ae741b66856d9bc98aa4e.css integrity="sha512-jbnrtcfg7QwiZbZFzV/cUNhuEz4WRfYetZ3gVlFiUCeRrhMyFEgAdsBORsOEENRHyg58yeka50G2aFbZvJiqTg=="><script>const theme=window.localStorage.getItem("theme");theme&&theme!=="1"&&document.documentElement.classList.add("theme-"+theme)</script></head><body><main class=site__content><div class=site__page><nav class=site__breadcrumbs><a class=site__breadcrumb href=https://oblitorum.github.io/>Home</a><a class=site__breadcrumb href=https://oblitorum.github.io/articles/>Articles</a><a class=site__breadcrumb--active href=https://oblitorum.github.io/articles/be-aware-of-how-listenandservetls-handles-http-request-on-golang-net-http-package/>Be Aware of How ListenAndServeTLS Handles Http Request on Golang net/http Package</a></nav><h1 class=page__title>Be Aware of How ListenAndServeTLS Handles Http Request on Golang net/http Package</h1><div class=page__meta><p><span class=page__date>on <time datetime=2022-04-04T17:53:38+08:00>2022-04-04</time></span></p></div></div></div><article class=page__content><p>On version >= 1.12, Golang changes its way to handle HTTP request when you serve with ListenAndServeTLS method. The difference is shown on below image, which is taken from this <a href=https://github.com/golang/go/compare/go1.11.13...golang:go1.12>link</a>.</p><p><img src=/images/be-aware-of-how-listenandservetls-handles-http-request-on-golang-net-http-package-1.png alt="golang 1.11.13 and 1.12 diff image"></p><p>As we can see, on version &lt; 1.12, it just returns without writing anything in response, which makes a &lsquo;malformed HTTP response&rsquo; error when you use Get or Client.Do with net/http package. And on version >= 1.12, it will return an 400 response with &lsquo;Client sent an HTTP request to an HTTPS server.&rsquo; message.</p><p>Some third-party packages haven&rsquo;t noticed this difference yet, they may use &lsquo;malformed HTTP response&rsquo; error to check if server setup TLS or not. For example, <a href=https://github.com/percona/pmm-client/blob/cd42b1da19df0a278302a74d475db1e8e1fe0cb1/pmm/check_network.go#L365>this one</a> uses this way, it will cause a problem if the server is built with Golang version >= 1.12.</p></article></main><footer class=site__footer><p class=footer__sign>Unless explicitly stated, all content released here are licensed under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0>CC BY-NC-SA 4.0</a>.</p></footer><script>window.addEventListener("load",function(){const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js",e.async=!0,document.head.appendChild(e)})</script><script defer type=text/javascript src=https://oblitorum.github.io/js/script.1897f19c12e6b3cefe239c0d871f0584a9f198089b37dd9040045dad2f59ed0d2a2dd9edbc4f47337abb3af0e45877c1d3f1b5fed24245c8b7f7dfcac1ad54f1.js integrity="sha512-GJfxnBLms87+I5wNhx8FhKnxmAibN92QQARdrS9Z7Q0qLdntvE9HM3q7OvDkWHfB0/G1/tJCRci399/Kwa1U8Q=="></script></body></html>